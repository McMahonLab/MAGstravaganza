treefile <- read.tree("C:/Users/Alex/Desktop/MAGstravaganza/Data_files/allMAGS.nwk")
metadata <- read.csv("C:/Users/Alex/Desktop/MAGstravaganza/Supplemental/MAG_information.csv", header = T, colClasses = c("character", "character", "factor", "character", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"))
table <- read.csv("C:/Users/Alex/Desktop/MAGstravaganza/Pathway_analysis/consolidated_pathway_data.csv", header = T)
# These genomes don't meet the stricter quality cutoffs I'm using in the pathway analysis (> 50% complete)
treefile <- drop.tip(treefile, "2582580570.genes.fna")
treefile <- drop.tip(treefile, "2582580574.genes.fna")
treefile <- drop.tip(treefile, "2593339180.genes.fna")
treefile <- drop.tip(treefile, "2593339186.genes.fna")
treefile <- drop.tip(treefile, "2593339193.genes.fna")
treefile <- drop.tip(treefile, "2588253500.genes.fna")
treefile <- drop.tip(treefile, "2582580534.genes.fna")
treefile <- drop.tip(treefile, "2582580704.genes.fna")
treefile <- drop.tip(treefile, "2582580707.genes.fna")
treefile <- drop.tip(treefile, "2582580709.genes.fna")
treefile <- drop.tip(treefile, "2582580714.genes.fna")
treefile <- drop.tip(treefile, "2582580604.genes.fna")
# Fix column names and grab N2 fixation data
colnames(table) <- gsub("X", "", colnames(table))
table <- table[1:61,]
for(i in 3:dim(table)[2]){
column <- table[,i]
column[which(is.na(column) == T)] <- 0
table[,i] <- column
}
hasN2 <- table[3, ] > 0
tips <- treefile$tip.label
tips <- gsub(".genes.fna", "", tips)
# Make keys for coloring tips
lakes <- metadata$Lake[match(tips, metadata$IMG_OID)]
Nfix <- hasN2[match(tips, colnames(table))]
key <- data.frame(tips, lakes, Nfix)
lake.colors <- c()
lake.colors[which(key$lakes == "Mendota" & key$Nfix == TRUE)] <- "#FF0000"
lake.colors[which(key$lakes == "Trout Bog Epilimnion" & key$Nfix == TRUE)] <- "#8EEB00"
lake.colors[which(key$lakes == "Trout Bog Hypolimnion" & key$Nfix == TRUE)] <- "#00A287"
lake.colors[which(is.na(key$lakes) == T | key$Nfix == FALSE)] <- "white"
m1 <- match(colnames(table)[3:196], metadata$IMG_OID)
sorted_metadata <- metadata[m1[which(is.na(m1) == F)],]
key <- paste(sorted_metadata$Lake, hasN2[3:196], sep = ":")
# Plot the tree with colors by lake for N2 fixers
plot(treefile, type = "fan", show.tip.label = F, main = "", edge.width = 3)
tiplabels(pch = 21, col = "black", bg = lake.colors, cex = 2)
#Add another with tip labels so I can add phylum colors
plot(treefile, type = "fan", show.tip.label = T, main = "", edge.width = 3)
# Plot with colors by lake
key <- data.frame(tips, lakes, Nfix)
lake.colors2 <- c()
lake.colors2[which(key$lakes == "Mendota")] <- "#FF0000"
lake.colors2[which(key$lakes == "Trout Bog Epilimnion")] <- "#8EEB00"
lake.colors2[which(key$lakes == "Trout Bog Hypolimnion")] <- "#00A287"
plot(treefile, type = "fan", show.tip.label = F, main = "", edge.width = 3)
tiplabels(pch = 21, col = "black", bg = lake.colors2, cex = 2)
library(ggplot2)
library(cowplot)
library(reshape2)
library(ape)
treefile <- read.tree("C:/Users/Alex/Desktop/MAGstravaganza/Data_files/allMAGS.nwk")
metadata <- read.csv("C:/Users/Alex/Desktop/MAGstravaganza/Supplemental/MAG_information.csv", header = T, colClasses = c("character", "character", "factor", "character", "numeric", "numeric", "numeric", "numeric", "numeric", "numeric"))
table <- read.csv("C:/Users/Alex/Desktop/MAGstravaganza/Pathway_analysis/consolidated_pathway_data.csv", header = T)
# These genomes don't meet the stricter quality cutoffs I'm using in the pathway analysis (> 50% complete)
treefile <- drop.tip(treefile, "2582580570.genes.fna")
treefile <- drop.tip(treefile, "2582580574.genes.fna")
treefile <- drop.tip(treefile, "2593339180.genes.fna")
treefile <- drop.tip(treefile, "2593339186.genes.fna")
treefile <- drop.tip(treefile, "2593339193.genes.fna")
treefile <- drop.tip(treefile, "2588253500.genes.fna")
treefile <- drop.tip(treefile, "2582580534.genes.fna")
treefile <- drop.tip(treefile, "2582580704.genes.fna")
treefile <- drop.tip(treefile, "2582580707.genes.fna")
treefile <- drop.tip(treefile, "2582580709.genes.fna")
treefile <- drop.tip(treefile, "2582580714.genes.fna")
treefile <- drop.tip(treefile, "2582580604.genes.fna")
# Fix column names and grab N2 fixation data
colnames(table) <- gsub("X", "", colnames(table))
table <- table[1:61,]
for(i in 3:dim(table)[2]){
column <- table[,i]
column[which(is.na(column) == T)] <- 0
table[,i] <- column
}
hasN2 <- table[3, ] > 0
tips <- treefile$tip.label
tips <- gsub(".genes.fna", "", tips)
# Make keys for coloring tips
lakes <- metadata$Lake[match(tips, metadata$IMG_OID)]
Nfix <- hasN2[match(tips, colnames(table))]
key <- data.frame(tips, lakes, Nfix)
lake.colors <- c()
lake.colors[which(key$lakes == "Mendota" & key$Nfix == TRUE)] <- "#FF0000"
lake.colors[which(key$lakes == "Trout Bog Epilimnion" & key$Nfix == TRUE)] <- "#8EEB00"
lake.colors[which(key$lakes == "Trout Bog Hypolimnion" & key$Nfix == TRUE)] <- "#00A287"
lake.colors[which(is.na(key$lakes) == T | key$Nfix == FALSE)] <- "white"
m1 <- match(colnames(table)[3:196], metadata$IMG_OID)
sorted_metadata <- metadata[m1[which(is.na(m1) == F)],]
key <- paste(sorted_metadata$Lake, hasN2[3:196], sep = ":")
# Plot the tree with colors by lake for N2 fixers
plot(treefile, type = "fan", show.tip.label = F, main = "", edge.width = 3)
tiplabels(pch = 21, col = "black", bg = lake.colors, cex = 2)
#Add another with tip labels so I can add phylum colors
plot(treefile, type = "fan", show.tip.label = T, main = "", edge.width = 3)
# Plot with colors by lake
key <- data.frame(tips, lakes, Nfix)
lake.colors2 <- c()
lake.colors2[which(key$lakes == "Mendota")] <- "#FF0000"
lake.colors2[which(key$lakes == "Trout Bog Epilimnion")] <- "#8EEB00"
lake.colors2[which(key$lakes == "Trout Bog Hypolimnion")] <- "#00A287"
plot(treefile, type = "fan", show.tip.label = F, main = "", edge.width = 3)
tiplabels(pch = 21, col = "black", bg = lake.colors2, cex = 2)
#Load packages
library(ggplot2)
library(cowplot)
library(reshape2)
Mendota_raw_input <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/Mendota_results.txt", colClasses = c("character", "character", "numeric", "numeric"))
Mendota_dates <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/ME.sampledata.filtered.tsv", sep = "\t", header = T)
Mendota_dates$sample <- as.character(Mendota_dates$sample)
metadata <- read.csv("C:/Users/Alex/Desktop/MAGstravaganza/Supplemental/MAG_information.csv", header = T)
TE_raw_input <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/TE_results.txt", colClasses = c("character", "character", "numeric", "numeric"))
TE_dates <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/tb_epi.sample_data.filtered.txt", header = T, sep = "\t")
TE_dates$sample <- as.character(TE_dates$sample)
TH_raw_input <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/TH_results.txt", colClasses = c("character", "character", "numeric", "numeric"))
TH_dates <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/tb_hyp.sample_data.filtered.txt", header = T, sep = "\t")
TH_dates$sample <- as.character(TH_dates$sample)
# Convert to RPKM (reads per kilobase per million reads)
# general form: RPKM =   numReads / ( genomeLength/1000 * totalNumReads/1,000,000 )
size_vector <- metadata$Genome_Size[match(Mendota_raw_input$V1, metadata$IMG_OID)]
Mendota_RPKM <- Mendota_raw_input$V3/(size_vector/1000 * Mendota_raw_input$V4/1000000)
ME_results <- data.frame(Mendota_raw_input[,1:2], Mendota_RPKM)
colnames(ME_results) <- c("MAG", "metaG", "RPKM")
ME_results$Date <- as.Date(Mendota_dates$date[match(ME_results$metaG, Mendota_dates$sample)], format = "%m/%d/%y")
ME_results$Julian_Date <- as.numeric(format(ME_results$Date, "%j"))
ME_results <- ME_results[which(is.na(ME_results$Date) == F),]
size_vector <- metadata$Genome_Size[match(TE_raw_input$V1, metadata$IMG_OID)]
TE_RPKM <- TE_raw_input$V3/(size_vector/1000 * TE_raw_input$V4/1000000)
TE_results <- data.frame(TE_raw_input[,1:2], TE_RPKM)
colnames(TE_results) <- c("MAG", "metaG", "RPKM")
TE_results$Date <- as.Date(TE_dates$date[match(TE_results$metaG, TE_dates$sample)], format = "%m/%d/%y")
TE_results$Julian_Date <- as.numeric(format(TE_results$Date, "%j"))
TE_results <- TE_results[which(is.na(TE_results$Date) == F),]
size_vector <- metadata$Genome_Size[match(TH_raw_input$V1, metadata$IMG_OID)]
TH_RPKM <- TH_raw_input$V3/(size_vector/1000 * TH_raw_input$V4/1000000)
TH_results <- data.frame(TH_raw_input[,1:2], TH_RPKM)
colnames(TH_results) <- c("MAG", "metaG", "RPKM")
TH_results$Date <- as.Date(TH_dates$date[match(TH_results$metaG, TH_dates$sample)], format = "%m/%d/%y")
TH_results$Julian_Date <- as.numeric(format(TH_results$Date, "%j"))
TH_results <- TH_results[which(is.na(TH_results$Date) == F),]
seasons <- data.frame(x1 = c(75, 152, 244), x2 = c(151, 243, 334), y1 = c(0, 0, 0), y2 = c(Inf, Inf, Inf))
trace <- data.frame(input = ME_results$RPKM[which(ME_results$order == "Methylococcales")], dates = ME_results$Julian_Date[which(ME_results$order == "Methylococcales")])
trace <- trace[order(trace$dates),]
trace$line <- c(trace$input[1], mean(trace$input[1:2]), mean(trace$input[1:3]), mean(trace$input[1:4]), mean(trace$input[1:5]), mean(trace$input[1:6]), mean(trace$input[1:7]), mean(trace$input[1:8]), rollmean(trace$input, 9))
trace$MAG <- rep("2582580566", length(trace$line))
p1 <- ggplot(data = ME_results[which(ME_results$order == "Methylococcales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = ME_results$RPKM[which(ME_results$order == "Methylophilales")], dates = ME_results$Julian_Date[which(ME_results$order == "Methylophilales")], MAG =  ME_results$MAG[which(ME_results$order == "Methylophilales")])
trace1 <- trace[which(trace$MAG == "2582580561"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2582580598"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace <- rbind(trace1, trace2)
p2 <- ggplot(data = ME_results[which(ME_results$order == "Methylophilales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = TE_results$RPKM[which(TE_results$order == "Methylococcales")], dates = TE_results$Julian_Date[which(TE_results$order == "Methylococcales")], MAG =  TE_results$MAG[which(TE_results$order == "Methylococcales")])
trace <- trace[which(is.na(trace$input) == F), ]
trace1 <- trace[which(trace$MAG == "2582580615"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2582580639"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace3 <- trace[which(trace$MAG == "2582580646"), ]
trace3 <- trace3[order(trace3$dates),]
trace3$line <- c(trace3$input[1], mean(trace3$input[1:2]), mean(trace3$input[1:3]), mean(trace3$input[1:4]), mean(trace3$input[1:5]), mean(trace3$input[1:6]), mean(trace3$input[1:7]), mean(trace3$input[1:8]), rollmean(trace3$input, 9))
trace <- rbind(trace1, trace2, trace3)
p3 <- ggplot(data = TE_results[which(TE_results$order == "Methylococcales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = TE_results$RPKM[which(TE_results$order == "Methylophilales")], dates = TE_results$Julian_Date[which(TE_results$order == "Methylophilales")], MAG =  TE_results$MAG[which(TE_results$order == "Methylophilales")])
trace <- trace[which(is.na(trace$input) == F), ]
trace1 <- trace[which(trace$MAG == "2582580623"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2582580649"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace <- rbind(trace1, trace2)
p4 <- ggplot(data = TE_results[which(TE_results$order == "Methylophilales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = TH_results$RPKM[which(TH_results$order == "Methylococcales")], dates = TH_results$Julian_Date[which(TH_results$order == "Methylococcales")], MAG =  TH_results$MAG[which(TH_results$order == "Methylococcales")])
trace <- trace[which(is.na(trace$input) == F), ]
trace1 <- trace[which(trace$MAG == "2582580677"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2593339178"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace3 <- trace[which(trace$MAG == "2593339191"), ]
trace3 <- trace3[order(trace3$dates),]
trace3$line <- c(trace3$input[1], mean(trace3$input[1:2]), mean(trace3$input[1:3]), mean(trace3$input[1:4]), mean(trace3$input[1:5]), mean(trace3$input[1:6]), mean(trace3$input[1:7]), mean(trace3$input[1:8]), rollmean(trace3$input, 9))
trace <- rbind(trace1, trace2, trace3)
p5 <- ggplot(data = TH_results[which(TH_results$order == "Methylococcales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = TH_results$RPKM[which(TH_results$order == "Methylophilales")], dates = TH_results$Julian_Date[which(TH_results$order == "Methylophilales")], MAG =  TH_results$MAG[which(TH_results$order == "Methylophilales")])
trace <- trace[which(is.na(trace$input) == F), ]
trace1 <- trace[which(trace$MAG == "2582580712"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2593339176"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace3 <- trace[which(trace$MAG == "2593339182"), ]
trace3 <- trace3[order(trace3$dates),]
trace3$line <- c(trace3$input[1], mean(trace3$input[1:2]), mean(trace3$input[1:3]), mean(trace3$input[1:4]), mean(trace3$input[1:5]), mean(trace3$input[1:6]), mean(trace3$input[1:7]), mean(trace3$input[1:8]), rollmean(trace3$input, 9))
trace4 <- trace[which(trace$MAG == "2593339192"), ]
trace4 <- trace4[order(trace4$dates),]
trace4$line <- c(trace4$input[1], mean(trace4$input[1:2]), mean(trace4$input[1:3]), mean(trace4$input[1:4]), mean(trace4$input[1:5]), mean(trace4$input[1:6]), mean(trace4$input[1:7]), mean(trace4$input[1:8]), rollmean(trace4$input, 9))
trace <- rbind(trace1, trace2, trace3, trace4)
p6 <- ggplot(data = TH_results[which(TH_results$order == "Methylophilales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
meth <- plot_grid(p1, p3, p5, p2, p4, p6, nrow = 2, labels = c("A", "B", "C", "D", "E", "F"))
#save_plot("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/methylotroph_trace.pdf", meth, base_height = 5, base_aspect_ratio = 3)
library(zoo)
Mendota_raw_input <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/Mendota_results.txt", colClasses = c("character", "character", "numeric", "numeric"))
Mendota_dates <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/ME.sampledata.filtered.tsv", sep = "\t", header = T)
Mendota_dates$sample <- as.character(Mendota_dates$sample)
metadata <- read.csv("C:/Users/Alex/Desktop/MAGstravaganza/Supplemental/MAG_information.csv", header = T)
TE_raw_input <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/TE_results.txt", colClasses = c("character", "character", "numeric", "numeric"))
TE_dates <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/tb_epi.sample_data.filtered.txt", header = T, sep = "\t")
TE_dates$sample <- as.character(TE_dates$sample)
TH_raw_input <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/TH_results.txt", colClasses = c("character", "character", "numeric", "numeric"))
TH_dates <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/tb_hyp.sample_data.filtered.txt", header = T, sep = "\t")
TH_dates$sample <- as.character(TH_dates$sample)
# Convert to RPKM (reads per kilobase per million reads)
# general form: RPKM =   numReads / ( genomeLength/1000 * totalNumReads/1,000,000 )
size_vector <- metadata$Genome_Size[match(Mendota_raw_input$V1, metadata$IMG_OID)]
Mendota_RPKM <- Mendota_raw_input$V3/(size_vector/1000 * Mendota_raw_input$V4/1000000)
ME_results <- data.frame(Mendota_raw_input[,1:2], Mendota_RPKM)
colnames(ME_results) <- c("MAG", "metaG", "RPKM")
ME_results$Date <- as.Date(Mendota_dates$date[match(ME_results$metaG, Mendota_dates$sample)], format = "%m/%d/%y")
ME_results$Julian_Date <- as.numeric(format(ME_results$Date, "%j"))
ME_results <- ME_results[which(is.na(ME_results$Date) == F),]
size_vector <- metadata$Genome_Size[match(TE_raw_input$V1, metadata$IMG_OID)]
TE_RPKM <- TE_raw_input$V3/(size_vector/1000 * TE_raw_input$V4/1000000)
TE_results <- data.frame(TE_raw_input[,1:2], TE_RPKM)
colnames(TE_results) <- c("MAG", "metaG", "RPKM")
TE_results$Date <- as.Date(TE_dates$date[match(TE_results$metaG, TE_dates$sample)], format = "%m/%d/%y")
TE_results$Julian_Date <- as.numeric(format(TE_results$Date, "%j"))
TE_results <- TE_results[which(is.na(TE_results$Date) == F),]
size_vector <- metadata$Genome_Size[match(TH_raw_input$V1, metadata$IMG_OID)]
TH_RPKM <- TH_raw_input$V3/(size_vector/1000 * TH_raw_input$V4/1000000)
TH_results <- data.frame(TH_raw_input[,1:2], TH_RPKM)
colnames(TH_results) <- c("MAG", "metaG", "RPKM")
TH_results$Date <- as.Date(TH_dates$date[match(TH_results$metaG, TH_dates$sample)], format = "%m/%d/%y")
TH_results$Julian_Date <- as.numeric(format(TH_results$Date, "%j"))
TH_results <- TH_results[which(is.na(TH_results$Date) == F),]
seasons <- data.frame(x1 = c(75, 152, 244), x2 = c(151, 243, 334), y1 = c(0, 0, 0), y2 = c(Inf, Inf, Inf))
trace <- data.frame(input = ME_results$RPKM[which(ME_results$order == "Methylococcales")], dates = ME_results$Julian_Date[which(ME_results$order == "Methylococcales")])
trace <- trace[order(trace$dates),]
trace$line <- c(trace$input[1], mean(trace$input[1:2]), mean(trace$input[1:3]), mean(trace$input[1:4]), mean(trace$input[1:5]), mean(trace$input[1:6]), mean(trace$input[1:7]), mean(trace$input[1:8]), rollmean(trace$input, 9))
trace$MAG <- rep("2582580566", length(trace$line))
p1 <- ggplot(data = ME_results[which(ME_results$order == "Methylococcales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = ME_results$RPKM[which(ME_results$order == "Methylophilales")], dates = ME_results$Julian_Date[which(ME_results$order == "Methylophilales")], MAG =  ME_results$MAG[which(ME_results$order == "Methylophilales")])
trace1 <- trace[which(trace$MAG == "2582580561"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2582580598"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace <- rbind(trace1, trace2)
p2 <- ggplot(data = ME_results[which(ME_results$order == "Methylophilales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = TE_results$RPKM[which(TE_results$order == "Methylococcales")], dates = TE_results$Julian_Date[which(TE_results$order == "Methylococcales")], MAG =  TE_results$MAG[which(TE_results$order == "Methylococcales")])
trace <- trace[which(is.na(trace$input) == F), ]
trace1 <- trace[which(trace$MAG == "2582580615"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2582580639"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace3 <- trace[which(trace$MAG == "2582580646"), ]
trace3 <- trace3[order(trace3$dates),]
trace3$line <- c(trace3$input[1], mean(trace3$input[1:2]), mean(trace3$input[1:3]), mean(trace3$input[1:4]), mean(trace3$input[1:5]), mean(trace3$input[1:6]), mean(trace3$input[1:7]), mean(trace3$input[1:8]), rollmean(trace3$input, 9))
trace <- rbind(trace1, trace2, trace3)
p3 <- ggplot(data = TE_results[which(TE_results$order == "Methylococcales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = TE_results$RPKM[which(TE_results$order == "Methylophilales")], dates = TE_results$Julian_Date[which(TE_results$order == "Methylophilales")], MAG =  TE_results$MAG[which(TE_results$order == "Methylophilales")])
trace <- trace[which(is.na(trace$input) == F), ]
trace1 <- trace[which(trace$MAG == "2582580623"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2582580649"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace <- rbind(trace1, trace2)
p4 <- ggplot(data = TE_results[which(TE_results$order == "Methylophilales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = TH_results$RPKM[which(TH_results$order == "Methylococcales")], dates = TH_results$Julian_Date[which(TH_results$order == "Methylococcales")], MAG =  TH_results$MAG[which(TH_results$order == "Methylococcales")])
trace <- trace[which(is.na(trace$input) == F), ]
trace1 <- trace[which(trace$MAG == "2582580677"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2593339178"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace3 <- trace[which(trace$MAG == "2593339191"), ]
trace3 <- trace3[order(trace3$dates),]
trace3$line <- c(trace3$input[1], mean(trace3$input[1:2]), mean(trace3$input[1:3]), mean(trace3$input[1:4]), mean(trace3$input[1:5]), mean(trace3$input[1:6]), mean(trace3$input[1:7]), mean(trace3$input[1:8]), rollmean(trace3$input, 9))
trace <- rbind(trace1, trace2, trace3)
p5 <- ggplot(data = TH_results[which(TH_results$order == "Methylococcales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = TH_results$RPKM[which(TH_results$order == "Methylophilales")], dates = TH_results$Julian_Date[which(TH_results$order == "Methylophilales")], MAG =  TH_results$MAG[which(TH_results$order == "Methylophilales")])
trace <- trace[which(is.na(trace$input) == F), ]
trace1 <- trace[which(trace$MAG == "2582580712"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2593339176"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace3 <- trace[which(trace$MAG == "2593339182"), ]
trace3 <- trace3[order(trace3$dates),]
trace3$line <- c(trace3$input[1], mean(trace3$input[1:2]), mean(trace3$input[1:3]), mean(trace3$input[1:4]), mean(trace3$input[1:5]), mean(trace3$input[1:6]), mean(trace3$input[1:7]), mean(trace3$input[1:8]), rollmean(trace3$input, 9))
trace4 <- trace[which(trace$MAG == "2593339192"), ]
trace4 <- trace4[order(trace4$dates),]
trace4$line <- c(trace4$input[1], mean(trace4$input[1:2]), mean(trace4$input[1:3]), mean(trace4$input[1:4]), mean(trace4$input[1:5]), mean(trace4$input[1:6]), mean(trace4$input[1:7]), mean(trace4$input[1:8]), rollmean(trace4$input, 9))
trace <- rbind(trace1, trace2, trace3, trace4)
p6 <- ggplot(data = TH_results[which(TH_results$order == "Methylophilales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
meth <- plot_grid(p1, p3, p5, p2, p4, p6, nrow = 2, labels = c("A", "B", "C", "D", "E", "F"))
#save_plot("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/methylotroph_trace.pdf", meth, base_height = 5, base_aspect_ratio = 3)
seasons <- data.frame(x1 = c(75, 152, 244), x2 = c(151, 243, 334), y1 = c(0, 0, 0), y2 = c(Inf, Inf, Inf))
trace <- data.frame(input = ME_results$RPKM[which(ME_results$order == "Methylococcales")], dates = ME_results$Julian_Date[which(ME_results$order == "Methylococcales")])
head(trace)
ME_results$phylum <- metadata$phylum[match(ME_results$MAG, metadata$IMG_OID)]
ME_results$class <- metadata$class[match(ME_results$MAG, metadata$IMG_OID)]
ME_results$order <- metadata$order[match(ME_results$MAG, metadata$IMG_OID)]
TE_results$phylum <- metadata$phylum[match(TE_results$MAG, metadata$IMG_OID)]
TE_results$class <- metadata$class[match(TE_results$MAG, metadata$IMG_OID)]
TE_results$order <- metadata$order[match(TE_results$MAG, metadata$IMG_OID)]
TH_results$phylum <- metadata$phylum[match(TH_results$MAG, metadata$IMG_OID)]
TH_results$class <- metadata$class[match(TH_results$MAG, metadata$IMG_OID)]
TH_results$order <- metadata$order[match(TH_results$MAG, metadata$IMG_OID)]
seasons <- data.frame(x1 = c(75, 152, 244), x2 = c(151, 243, 334), y1 = c(0, 0, 0), y2 = c(Inf, Inf, Inf))
trace <- data.frame(input = ME_results$RPKM[which(ME_results$order == "Methylococcales")], dates = ME_results$Julian_Date[which(ME_results$order == "Methylococcales")])
trace <- trace[order(trace$dates),]
trace$line <- c(trace$input[1], mean(trace$input[1:2]), mean(trace$input[1:3]), mean(trace$input[1:4]), mean(trace$input[1:5]), mean(trace$input[1:6]), mean(trace$input[1:7]), mean(trace$input[1:8]), rollmean(trace$input, 9))
trace$MAG <- rep("2582580566", length(trace$line))
p1 <- ggplot(data = ME_results[which(ME_results$order == "Methylococcales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
p1
seasons <- data.frame(x1 = c(75, 152, 244), x2 = c(151, 243, 334), y1 = c(0, 0, 0), y2 = c(Inf, Inf, Inf))
trace <- data.frame(input = ME_results$RPKM[which(ME_results$order == "Methylococcales")], dates = ME_results$Julian_Date[which(ME_results$order == "Methylococcales")])
head(trace)
head(TE_RPKM)
head(TE_results)
head(metadata)
metadata$phylum <- sapply(strsplit(as.character(metadata$Taxonomy),";"), `[`, 1)
metadata$class<- sapply(strsplit(as.character(metadata$Taxonomy),";"), `[`, 2)
metadata$order <- sapply(strsplit(as.character(metadata$Taxonomy),";"), `[`, 3)
ME_results$phylum <- metadata$phylum[match(ME_results$MAG, metadata$IMG_OID)]
ME_results$class <- metadata$class[match(ME_results$MAG, metadata$IMG_OID)]
ME_results$order <- metadata$order[match(ME_results$MAG, metadata$IMG_OID)]
TE_results$phylum <- metadata$phylum[match(TE_results$MAG, metadata$IMG_OID)]
TE_results$class <- metadata$class[match(TE_results$MAG, metadata$IMG_OID)]
TE_results$order <- metadata$order[match(TE_results$MAG, metadata$IMG_OID)]
TH_results$phylum <- metadata$phylum[match(TH_results$MAG, metadata$IMG_OID)]
TH_results$class <- metadata$class[match(TH_results$MAG, metadata$IMG_OID)]
TH_results$order <- metadata$order[match(TH_results$MAG, metadata$IMG_OID)]
seasons <- data.frame(x1 = c(75, 152, 244), x2 = c(151, 243, 334), y1 = c(0, 0, 0), y2 = c(Inf, Inf, Inf))
trace <- data.frame(input = ME_results$RPKM[which(ME_results$order == "Methylococcales")], dates = ME_results$Julian_Date[which(ME_results$order == "Methylococcales")])
trace <- trace[order(trace$dates),]
trace$line <- c(trace$input[1], mean(trace$input[1:2]), mean(trace$input[1:3]), mean(trace$input[1:4]), mean(trace$input[1:5]), mean(trace$input[1:6]), mean(trace$input[1:7]), mean(trace$input[1:8]), rollmean(trace$input, 9))
trace$MAG <- rep("2582580566", length(trace$line))
p1 <- ggplot(data = ME_results[which(ME_results$order == "Methylococcales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = ME_results$RPKM[which(ME_results$order == "Methylophilales")], dates = ME_results$Julian_Date[which(ME_results$order == "Methylophilales")], MAG =  ME_results$MAG[which(ME_results$order == "Methylophilales")])
trace1 <- trace[which(trace$MAG == "2582580561"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2582580598"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace <- rbind(trace1, trace2)
p2 <- ggplot(data = ME_results[which(ME_results$order == "Methylophilales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = TE_results$RPKM[which(TE_results$order == "Methylococcales")], dates = TE_results$Julian_Date[which(TE_results$order == "Methylococcales")], MAG =  TE_results$MAG[which(TE_results$order == "Methylococcales")])
trace <- trace[which(is.na(trace$input) == F), ]
trace1 <- trace[which(trace$MAG == "2582580615"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2582580639"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace3 <- trace[which(trace$MAG == "2582580646"), ]
trace3 <- trace3[order(trace3$dates),]
trace3$line <- c(trace3$input[1], mean(trace3$input[1:2]), mean(trace3$input[1:3]), mean(trace3$input[1:4]), mean(trace3$input[1:5]), mean(trace3$input[1:6]), mean(trace3$input[1:7]), mean(trace3$input[1:8]), rollmean(trace3$input, 9))
trace <- rbind(trace1, trace2, trace3)
p3 <- ggplot(data = TE_results[which(TE_results$order == "Methylococcales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = TE_results$RPKM[which(TE_results$order == "Methylophilales")], dates = TE_results$Julian_Date[which(TE_results$order == "Methylophilales")], MAG =  TE_results$MAG[which(TE_results$order == "Methylophilales")])
trace <- trace[which(is.na(trace$input) == F), ]
trace1 <- trace[which(trace$MAG == "2582580623"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2582580649"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace <- rbind(trace1, trace2)
p4 <- ggplot(data = TE_results[which(TE_results$order == "Methylophilales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = TH_results$RPKM[which(TH_results$order == "Methylococcales")], dates = TH_results$Julian_Date[which(TH_results$order == "Methylococcales")], MAG =  TH_results$MAG[which(TH_results$order == "Methylococcales")])
trace <- trace[which(is.na(trace$input) == F), ]
trace1 <- trace[which(trace$MAG == "2582580677"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2593339178"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace3 <- trace[which(trace$MAG == "2593339191"), ]
trace3 <- trace3[order(trace3$dates),]
trace3$line <- c(trace3$input[1], mean(trace3$input[1:2]), mean(trace3$input[1:3]), mean(trace3$input[1:4]), mean(trace3$input[1:5]), mean(trace3$input[1:6]), mean(trace3$input[1:7]), mean(trace3$input[1:8]), rollmean(trace3$input, 9))
trace <- rbind(trace1, trace2, trace3)
p5 <- ggplot(data = TH_results[which(TH_results$order == "Methylococcales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
trace <- data.frame(input = TH_results$RPKM[which(TH_results$order == "Methylophilales")], dates = TH_results$Julian_Date[which(TH_results$order == "Methylophilales")], MAG =  TH_results$MAG[which(TH_results$order == "Methylophilales")])
trace <- trace[which(is.na(trace$input) == F), ]
trace1 <- trace[which(trace$MAG == "2582580712"), ]
trace1 <- trace1[order(trace1$dates),]
trace1$line <- c(trace1$input[1], mean(trace1$input[1:2]), mean(trace1$input[1:3]), mean(trace1$input[1:4]), mean(trace1$input[1:5]), mean(trace1$input[1:6]), mean(trace1$input[1:7]), mean(trace1$input[1:8]), rollmean(trace1$input, 9))
trace2 <- trace[which(trace$MAG == "2593339176"), ]
trace2 <- trace2[order(trace2$dates),]
trace2$line <- c(trace2$input[1], mean(trace2$input[1:2]), mean(trace2$input[1:3]), mean(trace2$input[1:4]), mean(trace2$input[1:5]), mean(trace2$input[1:6]), mean(trace2$input[1:7]), mean(trace2$input[1:8]), rollmean(trace2$input, 9))
trace3 <- trace[which(trace$MAG == "2593339182"), ]
trace3 <- trace3[order(trace3$dates),]
trace3$line <- c(trace3$input[1], mean(trace3$input[1:2]), mean(trace3$input[1:3]), mean(trace3$input[1:4]), mean(trace3$input[1:5]), mean(trace3$input[1:6]), mean(trace3$input[1:7]), mean(trace3$input[1:8]), rollmean(trace3$input, 9))
trace4 <- trace[which(trace$MAG == "2593339192"), ]
trace4 <- trace4[order(trace4$dates),]
trace4$line <- c(trace4$input[1], mean(trace4$input[1:2]), mean(trace4$input[1:3]), mean(trace4$input[1:4]), mean(trace4$input[1:5]), mean(trace4$input[1:6]), mean(trace4$input[1:7]), mean(trace4$input[1:8]), rollmean(trace4$input, 9))
trace <- rbind(trace1, trace2, trace3, trace4)
p6 <- ggplot(data = TH_results[which(TH_results$order == "Methylophilales"), ], aes(x = Julian_Date, y = RPKM, color = MAG)) + geom_point(size = 2) + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "none") + labs(x = "Julian Date") + scale_x_continuous(breaks = pretty(ME_results$Julian_Date, 30), limits = c(75, 334)) + geom_rect(data = seasons, inherit.aes = FALSE, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2), alpha = 0.1, fill = c("skyblue", "springgreen", "goldenrod"), color = "black") + geom_line(data = trace, aes(y = line, x = dates), size = 2) + scale_color_brewer(palette = "Set2")
meth <- plot_grid(p1, p3, p5, p2, p4, p6, nrow = 2, labels = c("A", "B", "C", "D", "E", "F"))
meth
save_plot("C:/Users/Alex/Desktop/MAGstravaganza/Manuscript_plots/Fig5.png", meth, base_height = 5, base_aspect_ratio = 3)
save_plot("C:/Users/Alex/Desktop/MAGstravaganza/Manuscript_plots/Fig5.pdf", meth, base_height = 5, base_aspect_ratio = 3)
