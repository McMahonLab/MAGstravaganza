lefse_input[1:10, 1:10]
head(lakekey)
# Add a 1st colum of the lake for each metagenome
# Make products a row
rownames(lefse_input) < lefse_input[,1]
# Add a 1st colum of the lake for each metagenome
# Make products a row
rownames(lefse_input) <- lefse_input[,1]
lefse_input <- lefse_input[,2:165]
lefse_input[1:10, 1:10]
lakerow <- c("lake", lakekey$Site[match(colnames(lefse_input), lakekey$sample)])
lakerow
lakekey$Site[match(colnames(lefse_input), lakekey$sample)]
colnames(lefse_input)
lakekey$sample
c("lake", lakekey$Site[match(colnames(lefse_input), as.character(lakekey$sample))])
match(colnames(lefse_input), as.character(lakekey$sample))
lakekey$Site[match(colnames(lefse_input), as.character(lakekey$sample))]
lakekey$site[match(colnames(lefse_input), as.character(lakekey$sample))
]
c("lake", lakekey$site[match(colnames(lefse_input), as.character(lakekey$sample))])
c("lake", as.character(lakekey$site[match(colnames(lefse_input), as.character(lakekey$sample))]))
lakerow <- c("lake", as.character(lakekey$site[match(colnames(lefse_input), as.character(lakekey$sample))]))
lakerow <- as.character(lakekey$site[match(colnames(lefse_input), as.character(lakekey$sample))])
lefse_input <- rbind(lakerow, lefse_input)
lefse_input[1:10, 1:10]
# Output
write.table(lefse_input, file = "C:/Users/Alex/Desktop/MAGstravaganza/Data_files/lefse_input.txt", quote = F, row.names = T, col.names = T)
rownames(lefse_input) <- gsub(" ", "_", rownames(lefse_input))
lefse_input[1:10, 1:10]
# Output
write.table(lefse_input, file = "C:/Users/Alex/Desktop/MAGstravaganza/Data_files/lefse_input.txt", quote = F, row.names = T, col.names = T)
# Output
write.table(lefse_input, file = "C:/Users/Alex/Desktop/MAGstravaganza/Data_files/lefse_input.txt", quote = F, row.names = T, col.names = T, sep = "\t")
lefse_input <- dcast(pathway_rpkm, Pathway ~ Var2)
pathway_rpkm <- aggregate(RPKM ~ Lake + Pathway, data = counts, mean)
lefse_input <- dcast(pathway_rpkm, Pathway ~ Var2)
head(pathway_rpkm)
lefse_input <- dcast(pathway_rpkm, Pathway ~ Lake)
head(lefse_input)
pathway_rpkm <- aggregate(RPKM ~ Var2 + Pathway, data = counts, mean)
lefse_input <- dcast(pathway_rpkm, Pathway ~ Var2)
head(lefse_input)
for (i in 1:dim(lefse_input)[1]){
row <- lefse_input[i,]
row[which(is.na(row) == T)] <- 0
lefse_input[i,] <- row
}
rownames(lefse_input) <- lefse_input[,1]
rownames(lefse_input) <- gsub(" ", "_", rownames(lefse_input))
lefse_input <- lefse_input[,2:165]
lakerow <- as.character(lakekey$site[match(colnames(lefse_input), as.character(lakekey$sample))])
lefse_input <- rbind(lakerow, lefse_input)
lefse_input[1:10, 1:10]
# Output
write.table(lefse_input, file = "C:/Users/Alex/Desktop/MAGstravaganza/Data_files/lefse_input.txt", quote = F, row.names = T, col.names = T, sep = "\t")
snorm <- read.csv("D:/geodes_data_tables/Sparkling_normalized.csv", header = T, row.names = 1)
tnorm <- read.csv("D:/geodes_data_tables/Trout_normalized.csv", header = T, row.names = 1)
mnorm <- read.csv("D:/geodes_data_tables/Mendota_normalized.csv", header = T, row.names = 1)
# Gene keys
mendota_key <- read.csv("D:/geodes_data_tables/Mendota_ID90_genekey_reclassified_2018-03-03.csv", header = T)
spark_key <- read.csv("D:/geodes_data_tables/Sparkling_ID90_genekey_reclassified_2018-03-03.csv", header = T)
trout_key <- read.csv("D:/geodes_data_tables/Trout_ID90_genekey_reclassified_2018-03-03.csv", header = T)
# Sample data
metadata <- read.csv(file = "C:/Users/Alex/Desktop/geodes/bioinformatics_workflow/R_processing/sample_metadata.csv", header = T)
cf_genes <- mendota_key[, grep("Chloroflexi", mendota_key$Taxonomy)
]
grep("Chloroflexi", mendota_key$Taxonomy)
cf_genes <- mendota_key[grep("Chloroflexi", mendota_key$Taxonomy), ]
head(cf_genes)
unique(cf_genes$Genome)
cf_genes$Counts <- rowSums(mnorm)[match(cf_genes$Gene, rownames(mnorm))]
head(cf_genes)
cf_genes <- cf_genes[order(cf_genes$Counts, decreasing = T), ]
head(cf_genes)
mendota_key[grep("Ga0164293_10271681", mendota_key$Gene), ]
mendota_key[grep("Ga0164293_1027168", mendota_key$Gene), ]
mendota_key$Taxonomy <- gsub("Bacteria;", "", mendota_key$Taxonomy)
mendota_key$Taxonomy <- gsub("Eukaryota;", "", mendota_key$Taxonomy)
mendota_key$Phylum <- sapply(strsplit(as.character(mendota_key$Taxonomy),";"), `[`, 1)
mnorm$Genes <- rownames(mnorm)
mnorm <- melt(mnorm)
mnorm$Timepoint <- metadata$Timepoint[match(mnorm$variable, metadata$Sample)]
mnorm$Taxonomy <- mendota_key$Phylum[match(mnorm$Genes, mendota_key$Gene)]
mnorm$Taxonomy <- gsub("Cryptophyta,Cryptophyceae,Pyrenomonadales,Geminigeraceae,Guillardia,theta", "Cryptophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Haptophyta,Prymnesiophyceae,Isochrysidales,Noelaerhabdaceae,Emiliania,huxleyi", "Haptophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Heterokonta,Coscinodiscophyceae,Thalassiosirales,Thalassiosiraceae,Thalassiosira,pseudonana", "Heterokonta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Heterokonta,Pelagophyceae,Pelagomonadales,Pelagomonadaceae,Aureococcus,anophagefferens", "Heterokonta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified unclassified unclassified unclassified unclassified", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION MH", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION LP", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION DUE TO FEW HITS IN PHYLODIST", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("None", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified unclassified Perkinsida", "Perkinsozoa", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified unclassified", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified Oligohymenophorea", "Ciliophora", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified Pelagophyceae", "Ochrophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Unclassified ", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("UnclassifiedIsochrysidales", "Haptophyta", mnorm$Taxonomy)
averaged_tax <- aggregate(value ~ Taxonomy + Timepoint, data = mnorm, mean)
wide_mnorm <- reshape(averaged_tax, idvar = "Taxonomy", timevar = "Timepoint", direction = "wide")
rownames(wide_mnorm) <- wide_mnorm$Taxonomy
wide_mnorm <- wide_mnorm[, 2:dim(wide_mnorm)[2]]
wide_mnorm <- wide_mnorm[which(rowSums(wide_mnorm) > 3000),]
mendota_phyla <- data.frame(Taxonomy = rownames(wide_mnorm), Sums = rowSums(wide_mnorm))
head(averaged_tax)
mnorm[1:10, 1:10]
mnorm <- read.csv("D:/geodes_data_tables/Mendota_normalized.csv", header = T, row.names = 1)
# How expressed is each phylum?
mendota_key$Taxonomy <- gsub("Bacteria;", "", mendota_key$Taxonomy)
mendota_key$Taxonomy <- gsub("Eukaryota;", "", mendota_key$Taxonomy)
mendota_key$Phylum <- sapply(strsplit(as.character(mendota_key$Taxonomy),";"), `[`, 1)
mnorm$Genes <- rownames(mnorm)
mnorm <- melt(mnorm)
mnorm$Timepoint <- metadata$Timepoint[match(mnorm$variable, metadata$Sample)]
mnorm$Taxonomy <- mendota_key$Phylum[match(mnorm$Genes, mendota_key$Gene)]
### Load packages
library(ggplot2)
library(cowplot)
library(reshape2)
mnorm <- read.csv("D:/geodes_data_tables/Mendota_normalized.csv", header = T, row.names = 1)
mendota_key$Taxonomy <- gsub("Bacteria;", "", mendota_key$Taxonomy)
mendota_key$Taxonomy <- gsub("Eukaryota;", "", mendota_key$Taxonomy)
mendota_key$Phylum <- sapply(strsplit(as.character(mendota_key$Taxonomy),";"), `[`, 1)
mnorm$Genes <- rownames(mnorm)
mnorm <- melt(mnorm)
mnorm$Timepoint <- metadata$Timepoint[match(mnorm$variable, metadata$Sample)]
mnorm$Taxonomy <- mendota_key$Phylum[match(mnorm$Genes, mendota_key$Gene)]
mnorm$Taxonomy <- gsub("Cryptophyta,Cryptophyceae,Pyrenomonadales,Geminigeraceae,Guillardia,theta", "Cryptophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Haptophyta,Prymnesiophyceae,Isochrysidales,Noelaerhabdaceae,Emiliania,huxleyi", "Haptophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Heterokonta,Coscinodiscophyceae,Thalassiosirales,Thalassiosiraceae,Thalassiosira,pseudonana", "Heterokonta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Heterokonta,Pelagophyceae,Pelagomonadales,Pelagomonadaceae,Aureococcus,anophagefferens", "Heterokonta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified unclassified unclassified unclassified unclassified", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION MH", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION LP", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION DUE TO FEW HITS IN PHYLODIST", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("None", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified unclassified Perkinsida", "Perkinsozoa", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified unclassified", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified Oligohymenophorea", "Ciliophora", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified Pelagophyceae", "Ochrophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Unclassified ", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("UnclassifiedIsochrysidales", "Haptophyta", mnorm$Taxonomy)
averaged_tax <- aggregate(value ~ Taxonomy + Timepoint, data = mnorm, mean)
wide_mnorm <- reshape(averaged_tax, idvar = "Taxonomy", timevar = "Timepoint", direction = "wide")
rownames(wide_mnorm) <- wide_mnorm$Taxonomy
wide_mnorm <- wide_mnorm[, 2:dim(wide_mnorm)[2]]
wide_mnorm <- wide_mnorm[which(rowSums(wide_mnorm) > 3000),]
mendota_phyla <- data.frame(Taxonomy = rownames(wide_mnorm), Sums = rowSums(wide_mnorm))
mendota_phyla
grep("Perkins", mendota_key$Taxonomy)
grep("Ignavi", mendota_key$Taxonomy)
wide_mnorm <- reshape(averaged_tax, idvar = "Taxonomy", timevar = "Timepoint", direction = "wide")
rownames(wide_mnorm) <- wide_mnorm$Taxonomy
wide_mnorm <- wide_mnorm[, 2:dim(wide_mnorm)[2]]
head(wide_mnorm)
mendota_phyla <- data.frame(Taxonomy = rownames(wide_mnorm), Sums = rowSums(wide_mnorm))
mendota_phyla
grep("Streptophyta", mendota_key$Taxonomy)
# Gene keys
mendota_key <- read.csv("D:/geodes_data_tables/Mendota_ID90_genekey_reclassified_2018-03-03.csv", header = T)
grep("Streptophyta", mendota_key$Taxonomy)
grep("Streptophyta", spark_key$Taxonomy)
# Gene keys
oldmendota_key <- read.csv("D:/geodes_data_tables/Mendota_ID90_genekey_reclassified.csv", header = T)
# Gene keys
oldmendota_key <- read.csv("D:/geodes_data_tables/oldMendota_ID90_genekey_reclassified.csv", header = T)
grep("Streptophyta", oldmendota_key$Taxonomy)
oldmendota_key[grep("Streptophyta", oldmendota_key$Taxonomy),]
oldmendota_key[grep("Perkins", oldmendota_key$Taxonomy),]
oldmendota_key[grep("Ignavi", oldmendota_key$Taxonomy),]
mendota_key[grep("Chloroflexi", mendota_key$Taxonomy),]
length(grep("Chloroflexi", mendota_key$Taxonomy))
mendota_key[grep("cytochrome c oxidase", mendota_key$Product),]
library(ggplot2)
library(cowplot)
library(reshape2)
#library(GeneCycle)
### Load data (start with only one to save RAM and comment the rest out)
# Normalized read tables
snorm <- read.csv("D:/geodes_data_tables/Sparkling_ID90_normalized_readcounts.csv", header = T, row.names = 1)
tnorm <- read.csv("D:/geodes_data_tables/Trout_ID90_normalized_readcounts.csv", header = T, row.names = 1)
mnorm <- read.csv("D:/geodes_data_tables/Mendota_ID90_normalized_readcounts.csv", header = T, row.names = 1)
# Gene keys
mendota_key <- read.csv("D:/geodes_data_tables/Mendota_ID90_genekey_reclassified_2018-03-03.csv", header = T)
spark_key <- read.csv("D:/geodes_data_tables/Sparkling_ID90_genekey_reclassified_2018-03-03.csv", header = T)
trout_key <- read.csv("D:/geodes_data_tables/Trout_ID90_genekey_reclassified_2018-03-03.csv", header = T)
# Sample data
metadata <- read.csv(file = "C:/Users/Alex/Desktop/geodes/bioinformatics_workflow/R_processing/sample_metadata.csv", header = T)
# How expressed is each phylum?
mendota_key$Taxonomy <- gsub("Bacteria;", "", mendota_key$Taxonomy)
mendota_key$Taxonomy <- gsub("Eukaryota;", "", mendota_key$Taxonomy)
mendota_key$Phylum <- sapply(strsplit(as.character(mendota_key$Taxonomy),";"), `[`, 1)
mnorm$Genes <- rownames(mnorm)
mnorm <- melt(mnorm)
mnorm$Timepoint <- metadata$Timepoint[match(mnorm$variable, metadata$Sample)]
mnorm$Taxonomy <- mendota_key$Phylum[match(mnorm$Genes, mendota_key$Gene)]
mnorm$Taxonomy <- gsub("Cryptophyta,Cryptophyceae,Pyrenomonadales,Geminigeraceae,Guillardia,theta", "Cryptophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Haptophyta,Prymnesiophyceae,Isochrysidales,Noelaerhabdaceae,Emiliania,huxleyi", "Haptophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Heterokonta,Coscinodiscophyceae,Thalassiosirales,Thalassiosiraceae,Thalassiosira,pseudonana", "Heterokonta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Heterokonta,Pelagophyceae,Pelagomonadales,Pelagomonadaceae,Aureococcus,anophagefferens", "Heterokonta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified unclassified unclassified unclassified unclassified", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION MH", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION LP", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION DUE TO FEW HITS IN PHYLODIST", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("None", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified unclassified Perkinsida", "Perkinsozoa", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified unclassified", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified Oligohymenophorea", "Ciliophora", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified Pelagophyceae", "Ochrophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Unclassified ", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("UnclassifiedIsochrysidales", "Haptophyta", mnorm$Taxonomy)
averaged_tax <- aggregate(value ~ Taxonomy + Timepoint, data = mnorm, mean)
wide_mnorm <- reshape(averaged_tax, idvar = "Taxonomy", timevar = "Timepoint", direction = "wide")
rownames(wide_mnorm) <- wide_mnorm$Taxonomy
wide_mnorm <- wide_mnorm[, 2:dim(wide_mnorm)[2]]
wide_mnorm <- wide_mnorm[which(rowSums(wide_mnorm) > 3000),]
mendota_phyla <- data.frame(Taxonomy = rownames(wide_mnorm), Sums = rowSums(wide_mnorm))
mendota_phyla$Taxonomy <- c("Unclassified", "Acidobacteria", "Actinobacteria", "Armatimonadetes", "Bacteroidetes", "TM7", "Chloroflexi", "Cryptophyta", "Cyanobacteria", "Deinococcus-Thermus", "Firmicutes", "Gemmatimonadetes", "Haptophyta", "Heterokonta", "Unclassified", "Planctomycetes", "Proteobacteria", "Spirochaetes", "Tenericutes", "Verrucomicrobia", "Viruses", "Unclassified")
unclassified <- mendota_phyla[which(mendota_phyla$Taxonomy == "Unclassified"), ]
mendota_phyla <- mendota_phyla[which(mendota_phyla$Taxonomy != "Unclassified"), ]
mendota_phyla <- rbind(mendota_phyla, c("Unclassified", sum(unclassified$Sums)))
mendota_phyla$Sums <- as.numeric(mendota_phyla$Sums)
mendota_phyla$Taxonomy <- factor(mendota_phyla$Taxonomy, levels = mendota_phyla$Taxonomy[order(mendota_phyla$Sums, decreasing = T)])
mendota_phyla$Type <- c("Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Algae",  "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Algae", "Algae", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Viruses", "Unclassified")
p <- ggplot(mendota_phyla, aes(x = Taxonomy, y = Sums, fill = Type)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90, vjust = 0, hjust = 1)) + scale_fill_brewer(palette = "Set2") + labs(x = "", y = "Read Counts", title = "Lake Mendota Metatranscriptomes")
head(mnorm)
mnorm$variable <- gsub(".nonrRNA", "", mnorm$variable)
mnorm$Timepoint <- metadata$Timepoint[match(mnorm$variable, metadata$Sample)]
head(mnorm)
averaged_tax <- aggregate(value ~ Taxonomy + Timepoint, data = mnorm, mean)
wide_mnorm <- reshape(averaged_tax, idvar = "Taxonomy", timevar = "Timepoint", direction = "wide")
rownames(wide_mnorm) <- wide_mnorm$Taxonomy
wide_mnorm <- wide_mnorm[, 2:dim(wide_mnorm)[2]]
wide_mnorm <- wide_mnorm[which(rowSums(wide_mnorm) > 3000),]
mendota_phyla <- data.frame(Taxonomy = rownames(wide_mnorm), Sums = rowSums(wide_mnorm))
mendota_phyla
mnorm$Taxonomy <- gsub("Heterokonta,Bacillariophyceae,Naviculales,Phaeodactylaceae,Phaeodactylum,tricornutum", "Heterokonta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Heterokonta,Ochrophyta,Eustigmataphyceae,Eustigmataceae,Nannochloropsis,gaditana", "Heterokonta", mnorm$Taxonomy)
averaged_tax <- aggregate(value ~ Taxonomy + Timepoint, data = mnorm, mean)
wide_mnorm <- reshape(averaged_tax, idvar = "Taxonomy", timevar = "Timepoint", direction = "wide")
rownames(wide_mnorm) <- wide_mnorm$Taxonomy
wide_mnorm <- wide_mnorm[, 2:dim(wide_mnorm)[2]]
wide_mnorm <- wide_mnorm[which(rowSums(wide_mnorm) > 3000),]
mendota_phyla <- data.frame(Taxonomy = rownames(wide_mnorm), Sums = rowSums(wide_mnorm))
wide_mnorm <- reshape(averaged_tax, idvar = "Taxonomy", timevar = "Timepoint", direction = "wide")
rownames(wide_mnorm) <- wide_mnorm$Taxonomy
wide_mnorm <- wide_mnorm[, 2:dim(wide_mnorm)[2]]
wide_mnorm <- wide_mnorm[which(rowSums(wide_mnorm) > 3000),]
mendota_phyla <- data.frame(Taxonomy = rownames(wide_mnorm), Sums = rowSums(wide_mnorm))
mendota_phyla
mendota_phyla$Taxonomy <- c("Unclassified", "Acidobacteria", "Actinobacteria", "Armatimonadetes", "Bacteroidetes", "TM7", "Chlorobi", "Chloroflexi", "Chlorophyta", "Cryptophyta", "Ciliophora", "Crenarchaeota", "Cyanobacteria", "Deinococcus-Thermus", "Elusimicrobia", "Firmicutes", "Gemmatimonadetes", "Haptophyta", "Heterokonta", "Ignavibacteria", "standard", "Unclassified", "Planctomycetes", "Proteobacteria", "Spirochaetes", "Tenericutes", "Unclassified", "Verrucomicrobia", "Viruses")
unclassified <- mendota_phyla[which(mendota_phyla$Taxonomy == "Unclassified"), ]
mendota_phyla <- mendota_phyla[which(mendota_phyla$Taxonomy != "Unclassified"), ]
mendota_phyla <- rbind(mendota_phyla, c("Unclassified", sum(unclassified$Sums)))
mendota_phyla$Sums <- as.numeric(mendota_phyla$Sums)
mendota_phyla$Taxonomy <- factor(mendota_phyla$Taxonomy, levels = mendota_phyla$Taxonomy[order(mendota_phyla$Sums, decreasing = T)])
mendota_phyla$Type <- c("Unclassified", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Algae", "Algae", "Protists", "Archaea", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Algae", "Algae", "Bacteria", "Internal Standard", "Unclassified", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Unclassified", "Bacteria", "Viruses")
mendota_phyla
mendota_phyla$Taxonomy <- c("Unclassified", "Acidobacteria", "Actinobacteria", "Armatimonadetes", "Bacteroidetes", "TM7", "Chlorobi", "Chloroflexi", "Chlorophyta", "Cryptophyta", "Ciliophora", "Crenarchaeota", "Cyanobacteria", "Deinococcus-Thermus", "Elusimicrobia", "Firmicutes", "Gemmatimonadetes", "Haptophyta", "Heterokonta", "Ignavibacteria", "standard", "Unclassified", "Planctomycetes", "Proteobacteria", "Spirochaetes", "Tenericutes", "Unclassified", "Verrucomicrobia", "Viruses", "Unclassified")
mendota_phyla <- data.frame(Taxonomy = rownames(wide_mnorm), Sums = rowSums(wide_mnorm))
mendota_phyla
c("Unclassified", "Acidobacteria", "Actinobacteria", "Armatimonadetes", "Bacteroidetes", "TM7", "Chlorobi", "Chloroflexi", "Chlorophyta", "Ciliophora", "Crenarchaeota", "Cyanobacteria", "Deinococcus-Thermus", "Elusimicrobia", "Firmicutes", "Gemmatimonadetes", "Haptophyta", "Heterokonta", "Ignavibacteria", "standard", "Unclassified", "Planctomycetes", "Proteobacteria", "Spirochaetes", "Tenericutes", "Unclassified", "Verrucomicrobia", "Viruses")
mendota_phyla$Taxonomy
mendota_phyla$Taxonomy <- c("Unclassified", "Acidobacteria", "Actinobacteria", "Armatimonadetes", "Bacteroidetes", "TM7", "Chlorobi", "Chloroflexi", "Chlorophyta", "Ciliophora", "Crenarchaeota", "Cryptophyta", "Cyanobacteria", "Deinococcus-Thermus", "Elusimicrobia", "Firmicutes", "Gemmatimonadetes", "Haptophyta", "Heterokonta", "Ignavibacteria", "standard", "Unclassified", "Planctomycetes", "Proteobacteria", "Spirochaetes", "Tenericutes", "Unclassified", "Verrucomicrobia", "Viruses")
mendota_phyla$Type <- c("Unclassified", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Algae", "Protists", "Archaea", "Algae", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Algae", "Algae", "Bacteria", "Internal Standard", "Unclassified", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Unclassified", "Bacteria", "Viruses")
ggplot(mendota_phyla, aes(x = Taxonomy, y = Sums, fill = Type)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90, vjust = 0, hjust = 1)) + scale_fill_brewer(palette = "Set2") + labs(x = "", y = "Read Counts", title = "Lake Mendota Metatranscriptomes")
mendota_phyla <- data.frame(Taxonomy = rownames(wide_mnorm), Sums = rowSums(wide_mnorm))
mendota_phyla$Taxonomy <- c("Unclassified", "Acidobacteria", "Actinobacteria", "Armatimonadetes", "Bacteroidetes", "TM7", "Chlorobi", "Chloroflexi", "Chlorophyta", "Ciliophora", "Crenarchaeota", "Cryptophyta", "Cyanobacteria", "Deinococcus-Thermus", "Elusimicrobia", "Firmicutes", "Gemmatimonadetes", "Haptophyta", "Heterokonta", "Ignavibacteria", "standard", "Unclassified", "Planctomycetes", "Proteobacteria", "Spirochaetes", "Tenericutes", "Unclassified", "Verrucomicrobia", "Viruses")
unclassified <- mendota_phyla[which(mendota_phyla$Taxonomy == "Unclassified"), ]
mendota_phyla <- mendota_phyla[which(mendota_phyla$Taxonomy != "Unclassified"), ]
mendota_phyla <- rbind(mendota_phyla, c("Unclassified", sum(unclassified$Sums)))
mendota_phyla$Sums <- as.numeric(mendota_phyla$Sums)
mendota_phyla$Taxonomy <- factor(mendota_phyla$Taxonomy, levels = mendota_phyla$Taxonomy[order(mendota_phyla$Sums, decreasing = T)])
mendota_phyla <- mendota_phyla[which(mendota$phyla$Taxonomy != "standard"), ]
mendota_phyla <- mendota_phyla[which(mendota_phyla$Taxonomy != "standard"), ]
mendota_phyla
mendota_phyla$Type <- c("Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Algae", "Protists", "Archaea", "Algae", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Algae", "Algae", "Bacteria", "Unclassified", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Viruses", "Unclassified")
mendota_phyla$Type <- c("Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Algae", "Protists", "Archaea", "Algae", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Algae", "Algae", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Viruses", "Unclassified")
ggplot(mendota_phyla, aes(x = Taxonomy, y = Sums, fill = Type)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90, vjust = 0, hjust = 1)) + scale_fill_brewer(palette = "Set2") + labs(x = "", y = "Read Counts", title = "Lake Mendota Metatranscriptomes")
library(ggplot2)
library(cowplot)
library(reshape2)
library(ape)
library(zoo)
Mendota_raw_input <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/Mendota_results.txt", colClasses = c("character", "character", "numeric", "numeric"))
Mendota_dates <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/ME.sampledata.filtered.tsv", sep = "\t", header = T)
Mendota_dates$sample <- as.character(Mendota_dates$sample)
metadata <- read.csv("C:/Users/Alex/Desktop/MAGstravaganza/Supplemental/MAG_information.csv", header = T)
TE_raw_input <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/TE_results.txt", colClasses = c("character", "character", "numeric", "numeric"))
TE_dates <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/tb_epi.sample_data.filtered.txt", header = T, sep = "\t")
TE_dates$sample <- as.character(TE_dates$sample)
TH_raw_input <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/TH_results.txt", colClasses = c("character", "character", "numeric", "numeric"))
TH_dates <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/tb_hyp.sample_data.filtered.txt", header = T, sep = "\t")
TH_dates$sample <- as.character(TH_dates$sample)
size_vector <- metadata$Genome_Size[match(Mendota_raw_input$V1, metadata$IMG_OID)]
Mendota_RPKM <- Mendota_raw_input$V3/(size_vector/1000 * Mendota_raw_input$V4/1000000)
ME_results <- data.frame(Mendota_raw_input[,1:2], Mendota_RPKM)
colnames(ME_results) <- c("MAG", "metaG", "RPKM")
ME_results$Date <- as.Date(Mendota_dates$date[match(ME_results$metaG, Mendota_dates$sample)], format = "%m/%d/%y")
ME_results$Julian_Date <- as.numeric(format(ME_results$Date, "%j"))
ME_results <- ME_results[which(is.na(ME_results$Date) == F),]
size_vector <- metadata$Genome_Size[match(TE_raw_input$V1, metadata$IMG_OID)]
TE_RPKM <- TE_raw_input$V3/(size_vector/1000 * TE_raw_input$V4/1000000)
TE_results <- data.frame(TE_raw_input[,1:2], TE_RPKM)
colnames(TE_results) <- c("MAG", "metaG", "RPKM")
TE_results$Date <- as.Date(TE_dates$date[match(TE_results$metaG, TE_dates$sample)], format = "%m/%d/%y")
TE_results$Julian_Date <- as.numeric(format(TE_results$Date, "%j"))
TE_results <- TE_results[which(is.na(TE_results$Date) == F),]
size_vector <- metadata$Genome_Size[match(TH_raw_input$V1, metadata$IMG_OID)]
TH_RPKM <- TH_raw_input$V3/(size_vector/1000 * TH_raw_input$V4/1000000)
TH_results <- data.frame(TH_raw_input[,1:2], TH_RPKM)
colnames(TH_results) <- c("MAG", "metaG", "RPKM")
TH_results$Date <- as.Date(TH_dates$date[match(TH_results$metaG, TH_dates$sample)], format = "%m/%d/%y")
TH_results$Julian_Date <- as.numeric(format(TH_results$Date, "%j"))
TH_results <- TH_results[which(is.na(TH_results$Date) == F),]
# Get taxonomy
metadata$phylum <- sapply(strsplit(as.character(metadata$Taxonomy),";"), `[`, 1)
ME_results$phylum <- metadata$phylum[match(ME_results$MAG, metadata$IMG_OID)]
TE_results$phylum <- metadata$phylum[match(TE_results$MAG, metadata$IMG_OID)]
TH_results$phylum <- metadata$phylum[match(TH_results$MAG, metadata$IMG_OID)]
head(TH_results)
agg_ME_phyla <- aggregate(RPKM ~ Phylum, data = ME_results, mean)
agg_ME_phyla <- aggregate(RPKM ~ phylum, data = ME_results, mean)
head(agg_ME_phyla)
agg_TE_phyla <- aggregate(RPKM ~ phylum, data = TE_results, mean)
agg_TH_phyla <- aggregate(RPKM ~ phylum, data = TH_results, mean)
agg_phyla <- rbind(agg_ME_phyla, agg_TE_phyla, agg_TH_phyla)
dim(agg_ME_phyla)
agg_phyla$Lake <- c(rep("Mendota", dim(agg_ME_phyla)[1]), rep("Trout Bog Epilimnion", dim(agg_TE_phyla)[1]), rep("Trout Bog Hypolimnion", dim(agg_TH_phyla)[1]))
head(agg_phyla)
ggplot(data = agg_phyla, aes(x = phylum, y = RPKM, group = Lake)) + geom_bar(stat = "identity", position = "dodge")
ggplot(data = agg_phyla, aes(x = phylum, y = RPKM, group = Lake, fill = Lake)) + geom_bar(stat = "identity", position = "dodge")
ggplot(data = agg_phyla, aes(x = phylum, y = RPKM, fill = Lake)) + geom_bar(stat = "identity", position = "dodge")
ggplot(data = agg_phyla, aes(x = phylum, y = RPKM, fill = Lake)) + geom_bar(stat = "identity", position = "dodge") + theme(axis.text.x = element_text(angle = 90, hjust = 1))
ggplot(data = agg_phyla, aes(x = phylum, y = RPKM, fill = Lake)) + geom_bar(stat = "identity", position = "dodge") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + labs(y = "Mean RPKM", x = NULL, title = "Number of metagenomic reads recruited by time series MAGs")
ggplot(data = agg_phyla, aes(x = phylum, y = RPKM, fill = Lake)) + geom_bar(stat = "identity", position = "dodge") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + labs(y = "Mean RPKM", x = NULL, title = "Metagenomic reads recruited by time series MAGs") + scale_fill_manual(values = c("#FF0000", "8EEB00", "#00A287"))
ggplot(data = agg_phyla, aes(x = phylum, y = RPKM, fill = Lake)) + geom_bar(stat = "identity", position = "dodge") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + labs(y = "Mean RPKM", x = NULL, title = "Metagenomic reads recruited by time series MAGs") + scale_fill_manual(values = c("#FF0000", "#8EEB00", "#00A287"))
ggplot(data = agg_phyla, aes(x = phylum, y = RPKM, fill = Lake)) + geom_bar(stat = "identity") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + labs(y = "Mean RPKM", x = NULL, title = "Metagenomic reads recruited by time series MAGs") + scale_fill_manual(values = c("#FF0000", "#8EEB00", "#00A287"))
ggplot(data = agg_phyla, aes(x = phylum, y = RPKM, fill = Lake)) + geom_bar(stat = "identity", position = "dodge") + theme(axis.text.x = element_text(angle = 90, hjust = 1)) + labs(y = "Mean RPKM", x = NULL, title = "Metagenomic reads recruited by time series MAGs") + scale_fill_manual(values = c("#FF0000", "#8EEB00", "#00A287"))
head(agg_hyla)
head(agg_phyla)
write.csv(agg_phyla, "C:/Users/Alex/Desktop/mag_recruitment_phyla_means.csv", row.names = F)
head(ME_results)
ME_results$Taxonomy <- metadata$Taxonomy[match(ME_results$MAG, metadata$IMG_OID)]
head(ME_results)
TE_results$Taxonomy <- metadata$Taxonomy[match(TE_results$MAG, metadata$IMG_OID)]
TH_results$Taxonomy <- metadata$Taxonomy[match(TH_results$MAG, metadata$IMG_OID)]
write.csv(ME_results, "C:/Users/Alex/Desktop/mendota_mag_recruitment.csv", row.names = F)
write.csv(TE_results, "C:/Users/Alex/Desktop/tbe_mag_recruitment.csv", row.names = F)
write.csv(TH_results, "C:/Users/Alex/Desktop/tbh_mag_recruitment.csv", row.names = F)
mendota <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/ME.sampledata.filtered.tsv", sep = "\t", header = T)
tbe <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/tb_epi.sample_data.filtered.txt", header = T, sep = "\t")
tbh <- read.table("C:/Users/Alex/Desktop/MAGstravaganza/time_series_mapping/tb_hyp.sample_data.filtered.txt", header = T, sep = "\t")
head(tbe)
head(tbh)
head(mendota)
metaG <- c(mendota$sample, tbe$sample, tbh$sample)
metaG <- c(paste(mendota$sample, ".len150", sep = ""), tbe$sample, tbh$sample)
head(metaG)
tail(metaG)
tail(tbh$sample)
metaG <- c(paste(mendota$sample, ".len150", sep = ""), as.character(tbe$sample), as.character(tbh$sample))
tail(tbh$sample)
tail(metaG)
i=1
results_file <- read.table(paste("D:/time_series_cog_blast/", sample, ".blast", sep = ""))
paste("D:/time_series_cog_blast/", sample, ".blast", sep = "")
sample
i
metaG[i]
sample <- metaG[i]
results_file <- read.table(paste("D:/time_series_cog_blast/", sample, ".blast", sep = ""))
head(results_file)
counts <- table(results_file$V2)
head(counts)
head(names(counts))
head(as.numeric(counts))
ID <- c()
COGs <- c()
NUM <- c()
for(i in 1:length(metaG)){
sample <- metaG[i]
results_file <- read.table(paste("D:/time_series_cog_blast/", sample, ".blast", sep = ""))
counts <- table(results_file$V2)
ID <- append(ID, rep(sample, length(counts)), length(ID))
COGs <- append(COGs, names(counts), length(COGs))
NUM <- append(NUM, as.numeric(counts), length(NUM))
}
i
metaG[i]
metaG <- metaG[which(metaG != "PTZH.len150")]
ID <- c()
COGs <- c()
NUM <- c()
for(i in 1:length(metaG)){
sample <- metaG[i]
results_file <- read.table(paste("D:/time_series_cog_blast/", sample, ".blast", sep = ""))
counts <- table(results_file$V2)
ID <- append(ID, rep(sample, length(counts)), length(ID))
COGs <- append(COGs, names(counts), length(COGs))
NUM <- append(NUM, as.numeric(counts), length(NUM))
}
metaG <- metaG[which(metaG != "PTZH.len150" & metaG != "IHSC")]
ID <- c()
COGs <- c()
NUM <- c()
for(i in 1:length(metaG)){
sample <- metaG[i]
results_file <- read.table(paste("D:/time_series_cog_blast/", sample, ".blast", sep = ""))
counts <- table(results_file$V2)
ID <- append(ID, rep(sample, length(counts)), length(ID))
COGs <- append(COGs, names(counts), length(COGs))
NUM <- append(NUM, as.numeric(counts), length(NUM))
}
i
metaG[121]
metaG <- metaG[which(metaG != "PTZH.len150" & metaG != "IHSC" & metaG != "IHTG")]
ID <- c()
COGs <- c()
NUM <- c()
for(i in 1:length(metaG)){
sample <- metaG[i]
results_file <- read.table(paste("D:/time_series_cog_blast/", sample, ".blast", sep = ""))
counts <- table(results_file$V2)
ID <- append(ID, rep(sample, length(counts)), length(ID))
COGs <- append(COGs, names(counts), length(COGs))
NUM <- append(NUM, as.numeric(counts), length(NUM))
}
i
metaG[i]
metaG <- metaG[which(metaG != "PTZH.len150" & metaG != "IHSC" & metaG != "IHTG" & metaG != "IHWH")]
ID <- c()
COGs <- c()
NUM <- c()
for(i in 1:length(metaG)){
sample <- metaG[i]
results_file <- read.table(paste("D:/time_series_cog_blast/", sample, ".blast", sep = ""))
counts <- table(results_file$V2)
ID <- append(ID, rep(sample, length(counts)), length(ID))
COGs <- append(COGs, names(counts), length(COGs))
NUM <- append(NUM, as.numeric(counts), length(NUM))
}
i
metaG[i]
metaG <- metaG[which(metaG != "PTZH.len150" & metaG != "IHSC" & metaG != "IHTG" & metaG != "IHWH" & metaG != "IHWX")]
ID <- c()
COGs <- c()
NUM <- c()
for(i in 1:length(metaG)){
sample <- metaG[i]
results_file <- read.table(paste("D:/time_series_cog_blast/", sample, ".blast", sep = ""))
counts <- table(results_file$V2)
ID <- append(ID, rep(sample, length(counts)), length(ID))
COGs <- append(COGs, names(counts), length(COGs))
NUM <- append(NUM, as.numeric(counts), length(NUM))
}
i
metaG[i]
metaG <- metaG[which(metaG != "PTZH.len150" & metaG != "IHSC" & metaG != "IHTG" & metaG != "IHWH" & metaG != "IHWX" & metaG != "IHWP")]
ID <- c()
COGs <- c()
NUM <- c()
for(i in 1:length(metaG)){
sample <- metaG[i]
results_file <- read.table(paste("D:/time_series_cog_blast/", sample, ".blast", sep = ""))
counts <- table(results_file$V2)
ID <- append(ID, rep(sample, length(counts)), length(ID))
COGs <- append(COGs, names(counts), length(COGs))
NUM <- append(NUM, as.numeric(counts), length(NUM))
}
long_results <- data.frame(ID, COGs, NUM)
head(long_results)
head(mendota)
hist(num)
hist(NUM)
length(which(NUM > 1000))
# Divide counts by size of metagenome
long_results$ID <- gsub(".len150", "", long_results$ID)
all_lengths <- rbind(mendota[,c(1,2)], tbe[,c(1,2)], tbh[,c(1,2)])
head(all_lengths)
meta_size <- all_lengths$reads[match(long_results$ID, all_lengths$sample)]
long_results$NUM <- long_results$NUM/meta_size
head(long_results)
lefse_input <- dcast(long_results, ID ~ COGs)
# Process time series cog blast results
library(reshape2)
lefse_input <- dcast(long_results, ID ~ COGs)
lefse_input[1:10, 1:10]
lefse_input <- dcast(long_results, COGs ~ ID)
lefse_input[1:10, 1:10]
for (i in 1:dim(lefse_input)[1]){
row <- lefse_input[i,]
row[which(is.na(row) == T)] <- 0
lefse_input[i,] <- row
}
lefse_input[1:10, 1:10]
# Add a 1st colum of the lake for each metagenome
# Make products a row. since output is tabular, replace spaces with underscores
rownames(lefse_input) <- lefse_input[,1]
dim(lefse_input)
lefse_input <- lefse_input[,2:dim(lefse_input)[2]]
lefse_input[1:10, 1:10]
lakekey <- read.csv("C:/Users/Alex/Desktop/MAGstravaganza/Data_files/metagenome_metadata.csv", header = T)
head(lakekey)
lakerow <- as.character(lakekey$site[match(colnames(lefse_input), as.character(lakekey$sample))])
lakerow
lefse_input <- rbind(lakerow, lefse_input)
write.table(lefse_input, file = "C:/Users/Alex/Desktop/MAGstravaganza/Data_files/lefse_input.txt", quote = F, row.names = T, col.names = T, sep = "\t")
